<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Episode 1: The Invisible Linked List - Manim-Style Animations</title>
    <style>
        .act-page {
            display: none;
            opacity: 0;
            transition: opacity 0.7s cubic-bezier(.4,0,.2,1);
            min-height: 60vh;
        }
        .act-page.active {
            display: block;
            opacity: 1;
        }
        .act-nav {
            display: flex;
            justify-content: space-between;
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.95);
            box-shadow: 0 -2px 16px 0 rgba(60,60,90,0.08);
            padding: 18px 8vw 18px 8vw;
            z-index: 1000;
        }
        .act-nav button {
            background: linear-gradient(90deg,#06b6d4 0%,#818cf8 100%);
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 12px 32px;
            font-size: 1.1em;
            font-family: inherit;
            cursor: pointer;
            box-shadow: 0 2px 8px 0 rgba(6,182,212,0.10);
            transition: background 0.2s;
        }
        .act-nav button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .feynman-why {
            background: rgba(255,255,200,0.85);
            border-left: 6px solid #facc15;
            border-radius: 10px;
            margin: 24px 0 12px 0;
            padding: 18px 22px;
            font-size: 1.08em;
            box-shadow: 0 2px 12px 0 rgba(250,204,21,0.10);
            color: #7c4700;
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }
        .feynman-diagram {
            background: rgba(236,254,255,0.85);
            border-left: 6px solid #06b6d4;
            border-radius: 10px;
            margin: 10px 0 24px 0;
            padding: 14px 22px;
            font-size: 1.02em;
            box-shadow: 0 2px 12px 0 rgba(6,182,212,0.10);
            color: #0e3a4a;
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }


        body {
            font-family: 'San Francisco', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            color: #222b3a;
            overflow-x: hidden;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 32px 16px 32px 16px;
        }

        h1 {
            text-align: center;
            margin: 40px 0;
            font-size: 2.8em;
            color: #222b3a;
            font-weight: 700;
            letter-spacing: -1px;
            text-shadow: 0 2px 12px rgba(0,0,0,0.04);
        }

        .section {
            margin: 56px 0;
            padding: 40px 32px;
            background: rgba(255,255,255,0.65);
            border-radius: 24px;
            border: 1px solid rgba(200,210,230,0.18);
            box-shadow: 0 8px 32px 0 rgba(60, 60, 90, 0.10), 0 1.5px 6px 0 rgba(60, 60, 90, 0.04);
            backdrop-filter: blur(16px);
        }

        .section-title {
            font-size: 1.9em;
            margin-bottom: 30px;
            color: #3a8dde;
            font-weight: 700;
        }

        .animation-canvas {
            width: 100%;
            height: 400px;
            background: rgba(255,255,255,0.55);
            border-radius: 18px;
            position: relative;
            overflow: hidden;
            margin: 20px 0;
            border: 1px solid rgba(200,210,230,0.18);
            box-shadow: 0 4px 24px rgba(60, 60, 90, 0.08);
            backdrop-filter: blur(12px);
        }

        .control-panel {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 28px;
            background: rgba(245, 245, 250, 0.85);
            border: 1.5px solid #e5e7eb;
            border-radius: 12px;
            color: #2563eb;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(60, 60, 90, 0.07);
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            background: #f1f5f9;
            color: #1d4ed8;
            box-shadow: 0 4px 16px rgba(37, 99, 235, 0.10);
        }

        .btn:active {
            background: #e0e7ef;
            color: #1e40af;
        }

        .btn.secondary {
            background: rgba(255, 255, 255, 0.85);
            color: #f59e42;
            border: 1.5px solid #f7b267;
        }

        .btn.secondary:hover {
            background: #fff6e9;
            color: #f4845f;
        }

        .btn.success {
            background: rgba(255, 255, 255, 0.85);
            color: #10b981;
            border: 1.5px solid #6ad1e3;
        }

        .btn.success:hover {
            background: #eaf6fb;
            color: #059669;
        }

        .description {
            margin: 20px 0;
            padding: 20px;
            background: #eaf6fb;
            border-left: 5px solid #3a8dde;
            border-radius: 8px;
            line-height: 1.7;
            font-size: 1.05em;
            color: #234;
        }

        .code-display {
            background: #f7fafc;
            padding: 25px;
            border-radius: 12px;
            font-family: 'Courier New', 'Consolas', monospace;
            font-size: 14px;
            margin: 20px 0;
            border: 1px solid #dbeafe;
            overflow-x: auto;
            box-shadow: 0 2px 8px rgba(58, 141, 222, 0.07);
            line-height: 1.6;
        }

        .code-display .keyword { color: #3a8dde; font-weight: 600; }
        .code-display .function { color: #3ec6a8; font-weight: 600; }
        .code-display .comment { color: #b6bfcf; font-style: italic; }
        .code-display .string { color: #f4845f; }

        .code-display.typing {
            position: relative;
        }

        .code-display .typing-cursor {
            display: inline-block;
            width: 10px;
            height: 20px;
            background: #667eea;
            animation: blink 1s infinite;
            vertical-align: middle;
            margin-left: 2px;
        }

        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }

        .code-display .code-line {
            opacity: 0;
            animation: fadeInLine 0.3s forwards;
        }

        @keyframes fadeInLine {
            to { opacity: 1; }
        }

        /* Node styles for animations */
        .node {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #e3ecf7 0%, #6ad1e3 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #234;
            font-weight: 700;
            box-shadow: 0 4px 16px rgba(58, 141, 222, 0.13);
            transition: all 1s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .node .label {
            font-size: 12px;
            opacity: 0.8;
        }

        .node .value {
            font-size: 18px;
            margin-top: 5px;
        }

        .arrow {
            position: absolute;
            height: 3px;
            background: #2563eb;
            transform-origin: left center;
            transition: all 1s ease;
        }

        .arrow::after {
            content: '';
            position: absolute;
            right: -10px;
            top: -5px;
            width: 0;
            height: 0;
            border-left: 12px solid #2563eb;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 4px 16px rgba(58, 141, 222, 0.13); }
            50% { transform: scale(1.1); box-shadow: 0 8px 24px rgba(58, 141, 222, 0.18); }
        }

        .highlight {
            animation: pulse 2s infinite;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(-100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: #eaf6fb;
            padding: 25px;
            border-radius: 12px;
            border: 1.5px solid #b6d0ee;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: #3a8dde;
            background: #f7fafc;
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2.2em;
            font-weight: 700;
            color: #3a8dde;
            margin: 15px 0;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.7;
        }

        .scale-break {
            background: #fff6e9;
            border-left: 5px solid #f7b267;
            padding: 25px;
            margin: 20px 0;
            border-radius: 10px;
        }

        .scale-break-title {
            color: #f4845f;
            font-weight: 700;
            margin-bottom: 12px;
            font-size: 1.3em;
        }

        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }

        .comparison-side {
            padding: 25px;
            border-radius: 12px;
            background: #f7fafc;
            border: 1.5px solid #dbeafe;
            transition: all 0.3s ease;
        }

        .comparison-side.naive {
            background: #fff6e9;
            border: 1.5px solid #f7b267;
        }

        .comparison-side.naive:hover {
            border-color: #f4845f;
            background: #fff2e0;
        }

        .comparison-side.production {
            background: #eaf6fb;
            border: 1.5px solid #6ad1e3;
        }

        .comparison-side.production:hover {
            border-color: #3ec6a8;
            background: #e3ecf7;
        }

        .comparison-title {
            font-size: 1.4em;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .comparison-side.naive .comparison-title {
            color: #f4845f;
        }

        .comparison-side.production .comparison-title {
            color: #3ec6a8;
        }

        @media (max-width: 768px) {
            .comparison {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .animation-canvas {
                height: 300px;
            }
        }
    </style>
</head>
    <body>
    <div id="acts-container">
        <div class="act-page active" id="act-prologue">
            <!-- Prologue: Setting the Stage -->
            <div class="prologue" style="background:rgba(236,254,255,0.7);border-radius:12px;padding:28px 32px;margin:32px 0 40px 0;box-shadow:0 2px 16px 0 rgba(6,182,212,0.10);font-size:1.18em;color:#0e3a4a;">
                <h1 style="margin-top:0;">From LeetCode to Production: The Invisible Linked List</h1>
                <p>
                    Welcome! Today, we‚Äôll journey from a simple interview question to the heart of Git‚Äôs engineering magic. Along the way, you‚Äôll see how a humble linked list becomes the backbone of a world-class version control system. Ready to discover the hidden layers beneath your code?
                </p>
            </div>
        </div>
    <div class="container">
        <h1>üîó Episode 1: The Invisible Linked List</h1>
        <p style="text-align: center; font-size: 1.2em; opacity: 0.8; margin-bottom: 40px;">
            From LeetCode to Production: How Git Scales to 100M Developers
        </p>


        <!-- Act Transition: Enter the Linked List -->
        <div class="act-transition" style="margin:24px 0 0 0;font-size:1.08em;color:#334155;">
            <em>Let‚Äôs start at the very beginning: a single linked list, the classic interview problem. But what secrets does it hold?</em>
        </div>
        <!-- Animation 1: Basic Linked List -->
        <div class="section">
            <h2 class="section-title">Act 1: The LeetCode Foundation</h2>
            <div class="description">
                <strong>LeetCode #206: Reverse Linked List</strong><br>
                The foundation of Git's commit history. Each commit is a node pointing to its parent.
                Watch as we build a simple linear commit chain.
            </div>
            <div class="feynman-why">
                <strong>Why does this matter?</strong><br>
                <span style="font-style:italic;">If you can reverse a linked list, you can understand how Git walks commit history. This is the core of every <code>git log</code> and <code>git bisect</code> operation!</span>
            </div>
            <div class="feynman-diagram">
                <em>Diagram:</em> <span style="color:#2563eb;">Pointer Dance</span> ‚Äî Show arrows and pointers moving step by step as the list is reversed, with a "You Are Here" label.
            </div>

            <div class="animation-canvas" id="canvas1"></div>

            <div class="control-panel">
                <button class="btn" onclick="animation1.addCommit()">Add Commit</button>
                <button class="btn secondary" onclick="animation1.reverseList()">Reverse List</button>
                <button class="btn" onclick="animation1.reset()">Reset</button>
            </div>

            <div class="code-display">
<span class="keyword">class</span> <span class="function">Commit</span>:
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">def</span> <span class="function">__init__</span>(self, message, parent=<span class="keyword">None</span>):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.message = message<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.parent = parent  <span class="comment"># Points to previous commit</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.timestamp = time.time()<br><br><span class="keyword">class</span> <span class="function">MiniGit</span>:<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">def</span> <span class="function">__init__</span>(self):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.head = <span class="keyword">None</span>  <span class="comment"># Most recent commit</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">def</span> <span class="function">commit</span>(self, message):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new_commit = Commit(message, self.head)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self.head = new_commit<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">return</span> new_commit
            </div>

            <div class="stats-panel">
                <div class="stat-card">
                    <div class="stat-label">Time Complexity</div>
                    <div class="stat-value">O(n)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Space Complexity</div>
                    <div class="stat-value">O(1)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Lines of Code</div>
                    <div class="stat-value">15</div>
                </div>
            </div>
        </div>


        <!-- Act Transition: From List to Memory Growth -->
        <div class="act-transition" style="margin:24px 0 0 0;font-size:1.08em;color:#334155;">
            <em>What happens when you add more commits? Suddenly, memory becomes a problem. Let‚Äôs see how Git solves it.</em>
        </div>
        <!-- Act Transition: From List to Memory Growth -->
        <div class="act-transition" style="margin:24px 0 0 0;font-size:1.08em;color:#334155;">
            <em>What happens when you add more commits? Suddenly, memory becomes a problem. Let‚Äôs see how Git solves it.</em>
        </div>
        <!-- Animation 2: Memory Growth -->
        <div class="section">
            <h2 class="section-title">Act 2: Scale Break #1 - Memory Explosion</h2>
            <div class="scale-break">
                <div class="scale-break-title">‚ö†Ô∏è The Problem</div>
                Every commit stores full snapshot. 100K commits = 1-10GB naive storage.
                Without compression, Git would be unusable at scale.
            </div>
            <div class="feynman-why">
                <strong>Why does this matter?</strong><br>
                <span style="font-style:italic;">If Git stored every file every time, your repo would explode in size. Understanding this is key to appreciating Git's efficiency tricks.</span>
            </div>
            <div class="feynman-diagram">
                <em>Diagram:</em> <span style="color:#f59e42;">Snapshot vs. Delta</span> ‚Äî Side-by-side: left, every commit is a full box; right, commits are small deltas chained together. Use color to show redundancy vs. savings.
            </div>

            <div class="animation-canvas" id="canvas2"></div>

            <div class="control-panel">
                <button class="btn" onclick="animation2.addCommits()">Add 10 Commits</button>
                <button class="btn success" onclick="animation2.applyPackfile()">Apply Packfile Compression</button>
                <button class="btn" onclick="animation2.reset()">Reset</button>
            </div>

            <div class="comparison">
                <div class="comparison-side naive">
                    <div class="comparison-title">‚ùå Naive Storage</div>
                    <ul style="line-height: 2;">
                        <li>Full snapshot per commit</li>
                        <li>No deduplication</li>
                        <li>No compression</li>
                        <li>100K commits = 10-100GB</li>
                    </ul>
                </div>
                <div class="comparison-side production">
                    <div class="comparison-title">‚úì Production (Packfile)</div>
                    <ul style="line-height: 2;">
                        <li>Delta compression</li>
                        <li>Content-addressable</li>
                        <li>Binary diff algorithm</li>
                        <li>100K commits = ~1GB (10-100x savings)</li>
                    </ul>
                </div>
            </div>

            <div class="stats-panel">
                <div class="stat-card">
                    <div class="stat-label">Naive Storage</div>
                    <div class="stat-value" id="naive-size">0 MB</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">With Packfile</div>
                    <div class="stat-value" id="packfile-size">0 MB</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Space Saved</div>
                    <div class="stat-value" id="space-saved">0%</div>
                </div>
            </div>
        </div>


        <!-- Act Transition: The Magic of Hashes -->
        <div class="act-transition" style="margin:24px 0 0 0;font-size:1.08em;color:#334155;">
            <em>Now, let‚Äôs peek behind the curtain: Git doesn‚Äôt store files by name, but by their content. Why is this so powerful?</em>
        </div>
        <!-- Animation 2.5: Content-Addressable Storage -->
        <div class="section">
            <h2 class="section-title">Act 2.5: The Magic of Content-Addressable Storage</h2>
            <div class="description">
                <strong>The Core Insight:</strong> Git doesn't store files by name‚Äîit stores by <em>content hash</em>.<br>
                If you commit the same <code>README.md</code> 1000 times across branches, Git stores it <strong>once</strong>.<br>
                Watch as duplicate files magically collapse into a single storage blob.
            </div>
            <div class="feynman-why">
                <strong>Why does this matter?</strong><br>
                <span style="font-style:italic;">This is why Git is so space-efficient. It‚Äôs not magic‚Äîit‚Äôs hashing and deduplication!</span>
            </div>
            <div class="feynman-diagram">
                <em>Diagram:</em> <span style="color:#059669;">Blob Collapsing</span> ‚Äî Animate identical files from different commits ‚Äúfalling‚Äù into a single shared blob, with a SHA-1 hash label.
            </div>

            <div class="animation-canvas" id="canvas2b"></div>

            <div class="control-panel">
                <button class="btn" onclick="animation2b.addDuplicateFiles()">Add Duplicate Files</button>
                <button class="btn success" onclick="animation2b.deduplicate()">Apply Content-Addressable Storage</button>
                <button class="btn" onclick="animation2b.reset()">Reset</button>
            </div>

            <div class="comparison">
                <div class="comparison-side naive">
                    <div class="comparison-title">‚ùå File-Based Storage</div>
                    <ul style="line-height: 2;">
                        <li>Store by path/name</li>
                        <li>Same content = multiple copies</li>
                        <li>1000 identical READMEs = 1000x storage</li>
                        <li>No automatic deduplication</li>
                    </ul>
                </div>
                <div class="comparison-side production">
                    <div class="comparison-title">‚úì Content-Addressable (Git)</div>
                    <ul style="line-height: 2;">
                        <li>Store by SHA-1 hash</li>
                        <li>Same content = single storage</li>
                        <li>1000 identical READMEs = 1x storage</li>
                        <li>Automatic deduplication</li>
                    </ul>
                </div>
            </div>

            <div class="stats-panel">
                <div class="stat-card">
                    <div class="stat-label">Files Added</div>
                    <div class="stat-value" id="files-added">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Unique Blobs Stored</div>
                    <div class="stat-value" id="blobs-stored">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Deduplication Ratio</div>
                    <div class="stat-value" id="dedup-ratio">1:1</div>
                </div>
            </div>

            <div class="code-display">
<span class="keyword">import</span> hashlib

<span class="keyword">class</span> <span class="function">ContentAddressableStore</span>:
    <span class="keyword">def</span> <span class="function">__init__</span>(self):
        self.objects = {}  <span class="comment"># hash -> content</span>
    
    <span class="keyword">def</span> <span class="function">store</span>(self, content):
        hash_id = hashlib.sha1(content.encode()).hexdigest()
        
        <span class="keyword">if</span> hash_id <span class="keyword">not in</span> self.objects:
            self.objects[hash_id] = content  <span class="comment"># Store once</span>
        
        <span class="keyword">return</span> hash_id  <span class="comment"># Same content = same hash</span>

<span class="comment"># Magic: 1000 identical files ‚Üí 1 storage blob</span>
store = ContentAddressableStore()
<span class="keyword">for</span> i <span class="keyword">in</span> range(1000):
    hash_id = store.store(<span class="string">"# README\nSame content"</span>)
    
<span class="keyword">print</span>(len(store.objects))  <span class="comment"># Output: 1 (not 1000!)</span>
            </div>
        </div>


        <!-- Act Transition: Danger Lurks‚ÄîCycles! -->
        <div class="act-transition" style="margin:24px 0 0 0;font-size:1.08em;color:#334155;">
            <em>But what if something goes wrong? Corruption and cycles can break everything. Let‚Äôs see how Git defends itself.</em>
        </div>
        <!-- Animation 3: Cycle Detection -->
        <div class="section">
            <h2 class="section-title">Act 3: Scale Break #2 - Corruption & Cycles</h2>
            <div class="scale-break">
                <div class="scale-break-title">‚ö†Ô∏è The Problem</div>
                Disk corruption or malicious edits can create cycles in commit history.
                Without detection, <code>git log</code> runs forever, consuming infinite memory.
            </div>
            <div class="feynman-why">
                <strong>Why does this matter?</strong><br>
                <span style="font-style:italic;">A single bad pointer can bring down your repo. Cycle detection is a real-world safeguard, not just a coding trick.</span>
            </div>
            <div class="feynman-diagram">
                <em>Diagram:</em> <span style="color:#ef4444;">Cycle Catastrophe</span> ‚Äî Draw a commit graph as a tree, then animate a ‚Äúrogue‚Äù arrow creating a cycle. Show fast/slow pointers colliding, with a ‚ÄúDanger: Infinite Loop!‚Äù sign.
            </div>


            <div class="description">
                <strong>Floyd's Cycle Detection Algorithm</strong><br>
                Two pointers (slow/fast). Slow moves 1 step, fast moves 2 steps. If they meet ‚Üí cycle exists.<br>
                <br>
                <strong>Why does this matter for Git?</strong><br>
                In Git, the commit history forms a Directed Acyclic Graph (DAG). If disk corruption or a malicious tool introduces a cycle, commands like <code>git log</code> or <code>git fsck</code> can loop forever or crash.<br>
                <br>
                <strong>Real-World Example:</strong> In 2022, a popular NPM package was corrupted by a faulty post-commit hook, introducing a cycle in the commit graph. This caused <code>git log</code> to hang and <code>git fsck</code> to report DAG corruption.<br>
                <br>
                <strong>How does Git detect this?</strong><br>
                Git's <code>fsck</code> command uses Floyd's algorithm to validate the commit graph. If a cycle is found, it reports an error and refuses to operate until the corruption is fixed.<br>
                <br>
                <strong>Production Implications:</strong> Large-scale systems like GitHub run integrity checks on millions of repositories daily. Detecting cycles early prevents data loss, infinite loops, and security vulnerabilities.<br>
                <br>
                <strong>Implementation (Production-Ready):</strong>
            </div>

            <div class="code-display">
<span class="keyword">class</span> <span class="function">GitIntegrityChecker</span>:
    <span class="keyword">def</span> <span class="function">validate_commit_dag</span>(self, head):
        <span class="comment"># Floyd's cycle detection for commit DAG</span>
        slow = fast = head
        <span class="keyword">while</span> fast <span class="keyword">and</span> fast.parent:
            slow = slow.parent
            fast = fast.parent.parent
            <span class="keyword">if</span> slow <span class="keyword">is</span> fast:
                <span class="keyword">raise</span> SystemError(<span class="string">"Cycle detected in commit history!"</span>)
        <span class="keyword">return True</span>

    <span class="keyword">def</span> <span class="function">run_fsck</span>(self, repo):
        <span class="comment"># Validate all refs and report issues</span>
        <span class="keyword">for</span> ref <span class="keyword">in</span> repo.refs:
            <span class="keyword">try</span>:
                self.validate_commit_dag(ref.head)
            <span class="keyword">except</span> SystemError <span class="keyword">as</span> e:
                print(<span class="string">f"[ERROR] {ref.name}: {e}"</span>)
        print(<span class="string">"Integrity check complete."</span>)
            </div>

            <div class="description" style="background: rgba(255,0,110,0.08); border-left: 5px solid #ff006e; color: #ffd6e0;">
                <strong>DFS vs Floyd's:</strong> DFS can also detect cycles, but Floyd's is O(1) space and robust for very large graphs. Git uses Floyd's for efficiency and reliability.<br>
                <br>
                <strong>Takeaway:</strong> Cycle detection is not just a LeetCode trick‚Äîit's a critical production safeguard for the world's largest codebases.
            </div>

            <div class="animation-canvas" id="canvas3"></div>

            <div class="control-panel">
                <button class="btn" onclick="animation3.createValidChain()">Create Valid Chain</button>
                <button class="btn secondary" onclick="animation3.injectCycle()">Inject Cycle (Corrupt)</button>
                <button class="btn success" onclick="animation3.detectCycle()">Run Floyd's Detection</button>
                <button class="btn" onclick="animation3.reset()">Reset</button>
            </div>

            <div class="code-display">
<span class="keyword">def</span> <span class="function">validate_no_cycles</span>(head):
    <span class="keyword">if not</span> head:
        <span class="keyword">return True</span>
    
    slow = fast = head
    
    <span class="keyword">while</span> fast <span class="keyword">and</span> fast.parent:
        slow = slow.parent           <span class="comment"># Move 1 step</span>
        fast = fast.parent.parent    <span class="comment"># Move 2 steps</span>
        
        <span class="keyword">if</span> slow <span class="keyword">is</span> fast:
            <span class="keyword">raise</span> SystemError(<span class="string">"Cycle detected!"</span>)
    
    <span class="keyword">return True</span>  <span class="comment"># No cycle found</span>
            </div>

            <div id="cycle-result" style="margin-top: 20px; padding: 15px; border-radius: 8px; display: none;"></div>
        </div>


        <!-- Act Transition: Memory Matters -->
        <div class="act-transition" style="margin:24px 0 0 0;font-size:1.08em;color:#334155;">
            <em>Big repos mean big memory. What happens when you don‚Äôt set limits? Let‚Äôs watch the consequences‚Äîand the solutions.</em>
        </div>
        <!-- Animation 3.5: Memory Leak Without Bounds -->
        <div class="section">
            <h2 class="section-title">Act 3.5: Scale Break #3 - Unbounded Memory Growth</h2>
            <div class="scale-break">
                <div class="scale-break-title">‚ö†Ô∏è The Problem</div>
                Without memory limits, <code>git log --all</code> on huge repos loads entire history into RAM.<br>
                100K commits √ó 10KB metadata = 1GB RAM. 10M commits = system crash.
            </div>

            <div class="description">
                Watch what happens when we don't set memory bounds. The meter fills until the process crashes.
                Production Git uses streaming and pagination to prevent this.
            </div>
            <div class="feynman-why">
                <strong>Why does this matter?</strong><br>
                <span style="font-style:italic;">If you don‚Äôt control memory, your code won‚Äôt scale. This is the difference between a toy and a tool used by millions.</span>
            </div>
            <div class="feynman-diagram">
                <em>Diagram:</em> <span style="color:#f59e42;">Memory Overflow</span> ‚Äî Show a memory bar filling up as commits are loaded, then a ‚Äúcrash‚Äù icon. Contrast with a streaming bar that stays flat.
            </div>

            <div class="animation-canvas" id="canvas3b"></div>

            <div class="control-panel">
                <button class="btn secondary" onclick="animation3b.startUnbounded()">Load Without Limits</button>
                <button class="btn success" onclick="animation3b.startBounded()">Load With Streaming</button>
                <button class="btn" onclick="animation3b.reset()">Reset</button>
            </div>

            <div class="comparison">
                <div class="comparison-side naive">
                    <div class="comparison-title">‚ùå Load All Into Memory</div>
                    <ul style="line-height: 2;">
                        <li>Read entire history</li>
                        <li>Store all commits in RAM</li>
                        <li>Build full object graph</li>
                        <li>OOM on large repos</li>
                    </ul>
                </div>
                <div class="comparison-side production">
                    <div class="comparison-title">‚úì Streaming + Pagination</div>
                    <ul style="line-height: 2;">
                        <li>Load commits on-demand</li>
                        <li>Fixed memory window</li>
                        <li>LRU cache eviction</li>
                        <li>Constant memory usage</li>
                    </ul>
                </div>
            </div>

            <div class="stats-panel">
                <div class="stat-card">
                    <div class="stat-label">Unbounded Peak Memory</div>
                    <div class="stat-value" id="unbounded-memory">0 GB</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Bounded Peak Memory</div>
                    <div class="stat-value" id="bounded-memory">0 MB</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Memory Saved</div>
                    <div class="stat-value" id="memory-saved">N/A</div>
                </div>
            </div>

            <div id="crash-message" style="margin-top: 20px; padding: 15px; border-radius: 8px; display: none;"></div>
        </div>


        <!-- Act Transition: The Real World Arrives -->
        <div class="act-transition" style="margin:24px 0 0 0;font-size:1.08em;color:#334155;">
            <em>Algorithms are just the start. Production code needs layers: persistence, validation, monitoring. Let‚Äôs build them together.</em>
        </div>
        <!-- Animation 4: Engineering Layers -->
        <div class="section">
            <h2 class="section-title">Act 4: The Transformation (15 Lines ‚Üí 300+ Lines)</h2>
            <div class="description">
                The algorithm stays the same. What changes is <strong>everything around it</strong>.<br>
                Watch as we add production layers: persistence, validation, optimization, monitoring.
            </div>
            <div class="feynman-why">
                <strong>Why does this matter?</strong><br>
                <span style="font-style:italic;">Real-world code is more than algorithms. It‚Äôs about reliability, speed, and safety at scale.</span>
            </div>
            <div class="feynman-diagram">
                <em>Diagram:</em> <span style="color:#10b981;">Layer Cake</span> ‚Äî Animate a simple algorithm ‚Äúgrowing‚Äù layers: disk, validation, logging, monitoring, each as a new colored band.
            </div>

            <div class="animation-canvas" id="canvas4"></div>

            <div class="control-panel">
                <button class="btn" onclick="animation4.startAnimation()">Animate Transformation</button>
                <button class="btn" onclick="animation4.reset()">Reset</button>
            </div>

            <div class="comparison">
                <div class="comparison-side naive">
                    <div class="comparison-title">Naive (15 lines)</div>
                    <ul style="line-height: 2;">
                        <li>‚úì Works for demo</li>
                        <li>‚ùå No persistence</li>
                        <li>‚ùå No validation</li>
                        <li>‚ùå No error handling</li>
                        <li>‚ùå No optimization</li>
                        <li>‚ùå No monitoring</li>
                    </ul>
                </div>
                <div class="comparison-side production">
                    <div class="comparison-title">Production (300+ lines)</div>
                    <ul style="line-height: 2;">
                        <li>‚úì Content-addressable storage</li>
                        <li>‚úì Floyd's cycle detection</li>
                        <li>‚úì Packfile compression</li>
                        <li>‚úì Binary search indexes</li>
                        <li>‚úì Invariant checking</li>
                        <li>‚úì Metrics & observability</li>
                    </ul>
                </div>
            </div>

            <div class="stats-panel">
                <div class="stat-card">
                    <div class="stat-label">Code Growth</div>
                    <div class="stat-value">20x</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Engineering Layers</div>
                    <div class="stat-value">4</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Real Git</div>
                    <div class="stat-value">500K+ lines</div>
                </div>
            </div>
        </div>


        <!-- Act Transition: Speed is Everything -->
        <div class="act-transition" style="margin:24px 0 0 0;font-size:1.08em;color:#334155;">
            <em>Searching through history can be slow‚Äîor lightning fast. Let‚Äôs race linear vs binary search and see why Git is built for speed.</em>
        </div>
        <!-- Animation 4.5: Binary Search Race -->
        <div class="section">
            <h2 class="section-title">Act 4.5: Scale Break #4 - Search Speed</h2>
            <div class="scale-break">
                <div class="scale-break-title">‚ö†Ô∏è The Problem</div>
                Finding a commit in 100K objects with linear search = O(n) = 100K checks.<br>
                With binary search in sorted .idx files = O(log n) = 17 checks. That's a 5,882x speedup.
            </div>

            <div class="description">
                <strong>The Race:</strong> Watch linear search (red) vs binary search (blue) find commit #87,432.<br>
                This is why Git builds .idx files‚Äîthey turn O(n) into O(log n).
            </div>
            <div class="feynman-why">
                <strong>Why does this matter?</strong><br>
                <span style="font-style:italic;">Speed isn‚Äôt just about user experience‚Äîit‚Äôs about making large-scale collaboration possible.</span>
            </div>
            <div class="feynman-diagram">
                <em>Diagram:</em> <span style="color:#3b82f6;">Search Race</span> ‚Äî Animate two runners: one slogging through a long line (linear), one taking shortcuts (binary), with a finish line at the target commit.
            </div>

            <div class="animation-canvas" id="canvas4b"></div>

            <div class="control-panel">
                <button class="btn" onclick="animation4b.startRace()">Start Search Race</button>
                <button class="btn" onclick="animation4b.reset()">Reset</button>
            </div>

            <div class="comparison">
                <div class="comparison-side naive">
                    <div class="comparison-title">‚ùå Linear Search</div>
                    <ul style="line-height: 2;">
                        <li>Check every object sequentially</li>
                        <li>Time: O(n)</li>
                        <li>100K objects = 100K checks</li>
                        <li>Slow for large repos</li>
                    </ul>
                </div>
                <div class="comparison-side production">
                    <div class="comparison-title">‚úì Binary Search (.idx)</div>
                    <ul style="line-height: 2;">
                        <li>Sorted index file</li>
                        <li>Time: O(log n)</li>
                        <li>100K objects = 17 checks</li>
                        <li>5,882x faster!</li>
                    </ul>
                </div>
            </div>

            <div class="stats-panel">
                <div class="stat-card">
                    <div class="stat-label">Linear Checks</div>
                    <div class="stat-value" id="linear-checks">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Binary Checks</div>
                    <div class="stat-value" id="binary-checks">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Speedup Factor</div>
                    <div class="stat-value" id="speedup-factor">0x</div>
                </div>
            </div>

            <div class="code-display">
<span class="keyword">def</span> <span class="function">find_object_linear</span>(objects, target_hash):
    <span class="comment"># O(n) - check every object</span>
    <span class="keyword">for</span> obj <span class="keyword">in</span> objects:
        <span class="keyword">if</span> obj.hash == target_hash:
            <span class="keyword">return</span> obj
    <span class="keyword">return None</span>

<span class="keyword">def</span> <span class="function">find_object_binary</span>(idx_file, target_hash):
    <span class="comment"># O(log n) - binary search in sorted .idx</span>
    left, right = 0, len(idx_file) - 1
    
    <span class="keyword">while</span> left <= right:
        mid = (left + right) // 2
        <span class="keyword">if</span> idx_file[mid].hash == target_hash:
            <span class="keyword">return</span> idx_file[mid]
        <span class="keyword">elif</span> idx_file[mid].hash < target_hash:
            left = mid + 1
        <span class="keyword">else</span>:
            right = mid - 1
    <span class="keyword">return None</span>

<span class="comment"># 100,000 objects: Linear = 100K checks, Binary = 17 checks</span>
            </div>

            <div id="race-result" style="margin-top: 20px; padding: 15px; border-radius: 8px; display: none;"></div>
        </div>

        <!-- Act Transition: The Final Transformation -->
        <div class="act-transition" style="margin:24px 0 0 0;font-size:1.08em;color:#334155;">
            <em>We‚Äôve come full circle. Let‚Äôs see how all these layers combine to turn a simple idea into a tool used by millions.</em>
        </div>
        <!-- Animation 5: Engineering Layers -->
        <div class="section">
            <h2 class="section-title">Act 5: The Transformation (15 Lines ‚Üí 300+ Lines)</h2>
            <div class="description" style="font-size: 1.1em; line-height: 1.8;">
                <strong>Junior engineer:</strong> "Does it work?"<br>
                <strong>Senior engineer:</strong> "Does it scale?"<br>
                <strong>Staff engineer:</strong> "What breaks first, and how do we design for it?"<br><br>
                
                The algorithm is just the beginning. Production systems require:
                <ul style="margin-top: 15px; margin-left: 30px;">
                    <li><strong>Persistence</strong> - Content-addressable storage with atomic writes</li>
                    <li><strong>Memory</strong> - Delta compression and packfiles</li>
                    <li><strong>Corruption</strong> - Floyd's cycle detection and invariant checking</li>
                    <li><strong>Speed</strong> - Binary search indexes for O(log n) lookups</li>
                </ul>
                <br>
                This is what distinguishes levels. The algorithm stayed the same.<br>
                The engineering discipline made it real.
            </div>
            <div class="feynman-why">
                <strong>Why does this matter?</strong><br>
                <span style="font-style:italic;">The leap from code to product is engineering. This is how ideas change the world.</span>
            </div>
            <div class="feynman-diagram">
                <em>Diagram:</em> <span style="color:#a21caf;">Evolution</span> ‚Äî Show a simple linked list ‚Äúevolving‚Äù into a robust, multi-layered Git system, with each act‚Äôs icon joining the final product.
            </div>
        </div>
    </div>

    <script>
        // Animation 1: Basic Linked List
        class LinkedListAnimation {
            constructor(canvasId) {
                this.canvas = document.getElementById(canvasId);
                this.commits = [];
                this.commitCount = 0;
            }

            addCommit() {
                this.commitCount++;
                const commit = {
                    id: this.commitCount,
                    message: `Commit ${this.commitCount}`,
                    x: 150 + (this.commits.length * 150),
                    y: 200
                };
                this.commits.push(commit);
                this.render();
            }

            reverseList() {
                // Keep nodes in place but reverse arrow directions
                this.commits.forEach(commit => {
                    commit.reversed = !commit.reversed;
                });
                this.render();
            }

            reset() {
                this.commits = [];
                this.commitCount = 0;
                this.canvas.innerHTML = '';
            }

            render() {
                this.canvas.innerHTML = '';
                
                // Draw arrows first
                for (let i = 0; i < this.commits.length - 1; i++) {
                    const from = this.commits[i];
                    const to = this.commits[i + 1];
                    
                    // If reversed, flip arrow direction
                    if (from.reversed) {
                        this.drawArrow(to.x - 40, to.y, from.x + 40, from.y);
                    } else {
                        this.drawArrow(from.x + 40, from.y, to.x - 40, to.y);
                    }
                }

                // Draw nodes
                this.commits.forEach((commit, index) => {
                    this.drawNode(commit, index === 0);
                });
            }

            drawNode(commit, isHead) {
                const node = document.createElement('div');
                node.className = 'node';
                if (isHead) node.classList.add('highlight');
                node.style.left = `${commit.x - 40}px`;
                node.style.top = `${commit.y - 40}px`;
                node.innerHTML = `
                    <div class="label">${isHead ? 'HEAD' : 'Commit'}</div>
                    <div class="value">${commit.id}</div>
                `;
                this.canvas.appendChild(node);
            }

            drawArrow(x1, y1, x2, y2) {
                const arrow = document.createElement('div');
                arrow.className = 'arrow';
                const length = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
                const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
                
                arrow.style.width = `${length}px`;
                arrow.style.left = `${x1}px`;
                arrow.style.top = `${y1}px`;
                arrow.style.transform = `rotate(${angle}deg)`;
                
                this.canvas.appendChild(arrow);
            }
        }

        // Animation 2: Memory Growth
        class MemoryAnimation {
            constructor(canvasId) {
                this.canvas = document.getElementById(canvasId);
                this.commitCount = 0;
                this.isCompressed = false;
                this.naiveSize = 0;
                this.packfileSize = 0;
            }

            addCommits() {
                this.commitCount += 10;
                this.naiveSize = this.commitCount * 10; // 10MB per commit naive
                this.packfileSize = this.isCompressed ? Math.ceil(this.commitCount * 0.5) : this.naiveSize;
                this.render();
            }

            applyPackfile() {
                this.isCompressed = true;
                this.packfileSize = Math.ceil(this.commitCount * 0.5); // 20x compression
                this.render();
            }

            reset() {
                this.commitCount = 0;
                this.isCompressed = false;
                this.naiveSize = 0;
                this.packfileSize = 0;
                this.render();
            }

            render() {
                const naiveHeight = Math.min(350, this.naiveSize * 2);
                const packfileHeight = Math.min(350, this.packfileSize * 2);
                
                this.canvas.innerHTML = `
                    <div style="display: flex; justify-content: space-around; align-items: flex-end; height: 100%; padding: 30px;">
                        <div style="text-align: center;">
                            <div style="width: 150px; height: ${naiveHeight}px; background: linear-gradient(180deg, #f5576c 0%, #f093fb 100%); border-radius: 10px 10px 0 0; transition: all 1.2s ease;"></div>
                            <div style="margin-top: 10px; font-weight: bold;">Naive Storage</div>
                            <div style="font-size: 1.5em; color: #f5576c; margin-top: 5px;">${this.naiveSize} MB</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="width: 150px; height: ${packfileHeight}px; background: linear-gradient(180deg, #4facfe 0%, #00f2fe 100%); border-radius: 10px 10px 0 0; transition: all 0.5s ease;"></div>
                            <div style="margin-top: 10px; font-weight: bold;">Packfile ${this.isCompressed ? '‚úì' : ''}</div>
                            <div style="font-size: 1.5em; color: #4facfe; margin-top: 5px;">${this.packfileSize} MB</div>
                        </div>
                    </div>
                `;

                // Add same transition to packfile bar
                const packfileBar = this.canvas.querySelector('div[style*="#4facfe"]');
                if (packfileBar && packfileBar.parentElement) {
                    packfileBar.parentElement.querySelector('div:first-child').style.transition = 'all 1.2s ease';
                }

                document.getElementById('naive-size').textContent = `${this.naiveSize} MB`;
                document.getElementById('packfile-size').textContent = `${this.packfileSize} MB`;
                
                const saved = this.naiveSize > 0 ? Math.round((1 - this.packfileSize / this.naiveSize) * 100) : 0;
                document.getElementById('space-saved').textContent = `${saved}%`;
            }
        }

        // Animation 2b: Content-Addressable Storage
        class ContentAddressableAnimation {
            constructor(canvasId) {
                this.canvas = document.getElementById(canvasId);
                this.filesAdded = 0;
                this.uniqueBlobs = 0;
                this.isDeduplicated = false;
            }

            addDuplicateFiles() {
                this.filesAdded += 10;
                this.uniqueBlobs = this.isDeduplicated ? 3 : this.filesAdded;
                this.render();
            }

            deduplicate() {
                this.isDeduplicated = true;
                this.uniqueBlobs = 3; // Collapse to unique content
                this.render();
            }

            reset() {
                this.filesAdded = 0;
                this.uniqueBlobs = 0;
                this.isDeduplicated = false;
                this.render();
            }

            render() {
                const fileBoxes = [];
                const blobBoxes = [];
                
                // Show files being added
                for (let i = 0; i < Math.min(this.filesAdded, 20); i++) {
                    const row = Math.floor(i / 10);
                    const col = i % 10;
                    const color = i % 3 === 0 ? '#667eea' : i % 3 === 1 ? '#764ba2' : '#f093fb';
                    fileBoxes.push(`
                        <div style="
                            width: 40px; height: 40px; 
                            background: ${color}; 
                            border-radius: 5px;
                            position: absolute;
                            left: ${50 + col * 45}px;
                            top: ${50 + row * 45}px;
                            opacity: 0.7;
                            transition: all 1s ease;
                        "></div>
                    `);
                }

                // Show unique blobs
                for (let i = 0; i < Math.min(this.uniqueBlobs, 20); i++) {
                    const row = Math.floor(i / 10);
                    const col = i % 10;
                    const color = i % 3 === 0 ? '#667eea' : i % 3 === 1 ? '#764ba2' : '#f093fb';
                    blobBoxes.push(`
                        <div style="
                            width: 50px; height: 50px; 
                            background: linear-gradient(135deg, ${color} 0%, ${color}dd 100%); 
                            border-radius: 8px;
                            border: 2px solid rgba(255,255,255,0.5);
                            position: absolute;
                            right: ${50 + col * 55}px;
                            top: ${50 + row * 55}px;
                            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.5);
                            transition: all 1s ease;
                        "></div>
                    `);
                }

                this.canvas.innerHTML = `
                    <div style="display: flex; justify-content: space-around; align-items: center; height: 100%; padding: 20px;">
                        <div style="position: relative; width: 45%; height: 100%; border: 2px dashed rgba(245, 87, 108, 0.3); border-radius: 10px; padding: 10px;">
                            <div style="position: absolute; top: 10px; left: 10px; font-weight: bold; color: #f5576c;">Files Added</div>
                            ${fileBoxes.join('')}
                        </div>
                        <div style="font-size: 3em; color: ${this.isDeduplicated ? '#4facfe' : '#666'}; transition: all 0.5s;">‚Üí</div>
                        <div style="position: relative; width: 45%; height: 100%; border: 2px dashed rgba(79, 172, 254, 0.3); border-radius: 10px; padding: 10px;">
                            <div style="position: absolute; top: 10px; left: 10px; font-weight: bold; color: #4facfe;">Unique Blobs</div>
                            ${blobBoxes.join('')}
                        </div>
                    </div>
                `;

                document.getElementById('files-added').textContent = this.filesAdded;
                document.getElementById('blobs-stored').textContent = this.uniqueBlobs;
                document.getElementById('dedup-ratio').textContent = 
                    this.filesAdded > 0 ? `${this.filesAdded}:${this.uniqueBlobs}` : '1:1';
            }
        }

        // Animation 3: Cycle Detection
        class CycleDetectionAnimation {
            constructor(canvasId) {
                this.canvas = document.getElementById(canvasId);
                this.nodes = [];
                this.hasCycle = false;
            }

            createValidChain() {
                this.hasCycle = false;
                this.nodes = [];
                // Scatter pattern for better visibility
                const positions = [
                    { x: 150, y: 200 },
                    { x: 350, y: 150 },
                    { x: 550, y: 250 },
                    { x: 750, y: 180 },
                    { x: 950, y: 220 }
                ];
                for (let i = 0; i < 5; i++) {
                    this.nodes.push({
                        id: i + 1,
                        x: positions[i].x,
                        y: positions[i].y,
                        next: i < 4 ? i + 1 : null
                    });
                }
                this.render();
                this.hideResult();
            }

            injectCycle() {
                if (this.nodes.length < 3) {
                    this.createValidChain();
                }
                // Create cycle: last node points to middle node
                this.nodes[this.nodes.length - 1].next = 2;
                this.hasCycle = true;
                this.render();
                this.hideResult();
            }

            detectCycle() {
                if (this.nodes.length === 0) return;

                const resultDiv = document.getElementById('cycle-result');
                resultDiv.style.display = 'block';

                if (this.hasCycle) {
                    resultDiv.style.background = 'rgba(245, 87, 108, 0.2)';
                    resultDiv.style.border = '2px solid #f5576c';
                    resultDiv.innerHTML = `
                        <strong style="color: #f5576c;">‚ö†Ô∏è CYCLE DETECTED!</strong><br>
                        Floyd's algorithm found a cycle in the commit chain.<br>
                        This indicates repository corruption. Git would fail with an error.
                    `;
                    this.animateDetection();
                } else {
                    resultDiv.style.background = 'rgba(79, 172, 254, 0.2)';
                    resultDiv.style.border = '2px solid #4facfe';
                    resultDiv.innerHTML = `
                        <strong style="color: #4facfe;">‚úì NO CYCLE FOUND</strong><br>
                        Repository structure is valid. Safe to proceed with operations.
                    `;
                }
            }

            animateDetection() {
                const nodes = this.canvas.querySelectorAll('.node');
                let slow = 0, fast = 0;
                
                const interval = setInterval(() => {
                    // Reset previous highlights
                    nodes.forEach(n => n.style.border = '3px solid transparent');
                    
                    // Highlight slow (blue) and fast (red)
                    if (slow < nodes.length) {
                        nodes[slow].style.border = '3px solid #4facfe';
                    }
                    if (fast < nodes.length) {
                        nodes[fast].style.border = '3px solid #f5576c';
                    }

                    slow = this.nodes[slow].next;
                    fast = this.nodes[fast].next;
                    if (fast !== null) fast = this.nodes[fast].next;

                    if (slow === fast || fast === null) {
                        clearInterval(interval);
                    }
                }, 1500);
            }

            reset() {
                this.nodes = [];
                this.hasCycle = false;
                this.canvas.innerHTML = '';
                this.hideResult();
            }

            hideResult() {
                document.getElementById('cycle-result').style.display = 'none';
            }

            render() {
                this.canvas.innerHTML = '';

                // Draw nodes
                this.nodes.forEach((node, index) => {
                    const nodeEl = document.createElement('div');
                    nodeEl.className = 'node';
                    nodeEl.style.left = `${node.x - 40}px`;
                    nodeEl.style.top = `${node.y - 40}px`;
                    nodeEl.innerHTML = `
                        <div class="label">Node</div>
                        <div class="value">${node.id}</div>
                    `;
                    this.canvas.appendChild(nodeEl);

                    // Draw arrow to next
                    if (node.next !== null) {
                        const nextNode = this.nodes[node.next];
                        this.drawArrow(node.x + 40, node.y, nextNode.x - 40, nextNode.y);
                    }
                });
            }

            drawArrow(x1, y1, x2, y2) {
                const arrow = document.createElement('div');
                arrow.className = 'arrow';
                const length = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
                const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
                
                arrow.style.width = `${length}px`;
                arrow.style.left = `${x1}px`;
                arrow.style.top = `${y1}px`;
                arrow.style.transform = `rotate(${angle}deg)`;
                
                this.canvas.appendChild(arrow);
            }
        }

        // Animation 3b: Memory Leak
        class MemoryLeakAnimation {
            constructor(canvasId) {
                this.canvas = document.getElementById(canvasId);
                this.unboundedMemory = 0;
                this.boundedMemory = 0;
                this.isAnimating = false;
            }

            startUnbounded() {
                if (this.isAnimating) return;
                this.reset();
                this.isAnimating = true;
                this.animateUnbounded();
            }

            startBounded() {
                if (this.isAnimating) return;
                this.reset();
                this.isAnimating = true;
                this.animateBounded();
            }

            animateUnbounded() {
                if (!this.isAnimating) return;

                this.unboundedMemory += 0.5;
                this.render();

                document.getElementById('unbounded-memory').textContent = `${this.unboundedMemory.toFixed(1)} GB`;

                if (this.unboundedMemory >= 8) {
                    this.isAnimating = false;
                    const crashDiv = document.getElementById('crash-message');
                    crashDiv.style.display = 'block';
                    crashDiv.style.background = 'rgba(245, 87, 108, 0.2)';
                    crashDiv.style.border = '2px solid #f5576c';
                    crashDiv.innerHTML = `
                        <strong style="color: #f5576c;">üí• SYSTEM CRASH - OUT OF MEMORY</strong><br>
                        Process killed by OS. No memory bounds = system instability.<br>
                        This is why production systems must enforce resource limits.
                    `;
                } else {
                    setTimeout(() => this.animateUnbounded(), 500);
                }
            }

            animateBounded() {
                if (!this.isAnimating) return;

                // Bounded stays constant at 256MB
                this.boundedMemory = 256;
                this.unboundedMemory += 0.5;
                this.render();

                document.getElementById('bounded-memory').textContent = `${this.boundedMemory} MB`;
                document.getElementById('unbounded-memory').textContent = `${this.unboundedMemory.toFixed(1)} GB`;

                const saved = this.unboundedMemory > 0 ? 
                    Math.round((1 - (this.boundedMemory / 1024) / this.unboundedMemory) * 100) : 0;
                document.getElementById('memory-saved').textContent = `${saved}%`;

                if (this.unboundedMemory >= 8) {
                    this.isAnimating = false;
                    const crashDiv = document.getElementById('crash-message');
                    crashDiv.style.display = 'block';
                    crashDiv.style.background = 'rgba(79, 172, 254, 0.2)';
                    crashDiv.style.border = '2px solid #4facfe';
                    crashDiv.innerHTML = `
                        <strong style="color: #4facfe;">‚úì STABLE - BOUNDED MEMORY</strong><br>
                        Streaming keeps memory constant at ${this.boundedMemory}MB.<br>
                        Fixed memory window + LRU eviction = predictable performance.
                    `;
                } else {
                    setTimeout(() => this.animateBounded(), 500);
                }
            }

            reset() {
                this.unboundedMemory = 0;
                this.boundedMemory = 0;
                this.isAnimating = false;
                document.getElementById('crash-message').style.display = 'none';
                document.getElementById('unbounded-memory').textContent = '0 GB';
                document.getElementById('bounded-memory').textContent = '0 MB';
                document.getElementById('memory-saved').textContent = 'N/A';
                this.render();
            }

            render() {
                const unboundedHeight = Math.min(350, this.unboundedMemory * 40);
                const boundedHeight = 100; // Constant

                const unboundedColor = this.unboundedMemory > 6 ? '#f5576c' : 
                                        this.unboundedMemory > 4 ? '#f093fb' : '#764ba2';

                this.canvas.innerHTML = `
                    <div style="display: flex; justify-content: space-around; align-items: flex-end; height: 100%; padding: 30px;">
                        <div style="text-align: center;">
                            <div style="width: 150px; height: ${unboundedHeight}px; background: linear-gradient(180deg, ${unboundedColor} 0%, #f093fb 100%); border-radius: 10px 10px 0 0; transition: all 0.8s ease; position: relative;">
                                ${this.unboundedMemory > 6 ? '<div style="position: absolute; top: 10px; left: 50%; transform: translateX(-50%); font-size: 2em;">‚ö†Ô∏è</div>' : ''}
                            </div>
                            <div style="margin-top: 10px; font-weight: bold;">Unbounded</div>
                            <div style="font-size: 1.3em; color: #f5576c; margin-top: 5px;">${this.unboundedMemory.toFixed(1)} GB</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="width: 150px; height: ${boundedHeight}px; background: linear-gradient(180deg, #4facfe 0%, #00f2fe 100%); border-radius: 10px 10px 0 0; transition: all 0.3s ease;"></div>
                            <div style="margin-top: 10px; font-weight: bold;">Bounded (Streaming)</div>
                            <div style="font-size: 1.3em; color: #4facfe; margin-top: 5px;">${this.boundedMemory} MB</div>
                        </div>
                    </div>
                `;
                
                // Ensure bounded bar has same transition
                const bars = this.canvas.querySelectorAll('div[style*="border-radius: 10px 10px 0 0"]');
                bars.forEach(bar => { bar.style.transition = 'all 0.8s ease'; });
            }
        }

        // Animation 4: Engineering Layers
        class EngineeringLayersAnimation {
            constructor(canvasId) {
                this.canvas = document.getElementById(canvasId);
                this.layers = [
                    { name: 'Algorithm Core', color: '#667eea', height: 60, lines: '15 lines' },
                    { name: 'Persistence Layer', color: '#764ba2', height: 70, lines: '+50 lines' },
                    { name: 'Validation Layer', color: '#f093fb', height: 70, lines: '+75 lines' },
                    { name: 'Optimization Layer', color: '#4facfe', height: 80, lines: '+90 lines' },
                    { name: 'Monitoring Layer', color: '#00f2fe', height: 70, lines: '+75 lines' }
                ];
                this.currentLayer = 0;
            }

            startAnimation() {
                this.canvas.innerHTML = '';
                this.currentLayer = 0;
                this.animateNextLayer();
            }

            animateNextLayer() {
                if (this.currentLayer >= this.layers.length) return;

                const layer = this.layers[this.currentLayer];
                const totalHeight = this.layers.slice(0, this.currentLayer + 1)
                    .reduce((sum, l) => sum + l.height, 0);
                const startY = 50;
                
                // Create rectangle
                const layerEl = document.createElement('div');
                layerEl.style.cssText = `
                    position: absolute;
                    left: 50%;
                    transform: translateX(-50%);
                    top: ${startY + totalHeight - layer.height}px;
                    width: 500px;
                    height: ${layer.height}px;
                    background: linear-gradient(135deg, ${layer.color} 0%, ${layer.color}dd 100%);
                    border: 2px solid rgba(255, 255, 255, 0.3);
                    border-radius: 8px;
                    opacity: 0;
                    animation: fadeIn 0.5s ease forwards;
                    z-index: ${this.currentLayer};
                    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
                    animation-duration: 1s;
                `;
                
                // Create label at bottom right
                const labelEl = document.createElement('div');
                labelEl.style.cssText = `
                    position: absolute;
                    right: 15px;
                    bottom: 10px;
                    color: white;
                    font-weight: bold;
                    font-size: 14px;
                    text-align: right;
                    opacity: 0;
                    animation: fadeIn 0.5s ease forwards 0.3s;
                    text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
                    display: flex;
                    flex-direction: column;
                    align-items: flex-end;
                    animation-duration: 1s;
                `;
                labelEl.innerHTML = `
                    <span style="font-size: 15px;">${layer.name}</span>
                    <span style="font-size: 12px; opacity: 0.8; margin-top: 2px;">${layer.lines}</span>
                `;

                layerEl.appendChild(labelEl);
                this.canvas.appendChild(layerEl);
                this.currentLayer++;

                setTimeout(() => this.animateNextLayer(), 1200);
            }

            reset() {
                this.canvas.innerHTML = '';
                this.currentLayer = 0;
            }
        }

        // Animation 4b: Binary Search Race
        class BinarySearchAnimation {
            constructor(canvasId) {
                this.canvas = document.getElementById(canvasId);
                this.linearChecks = 0;
                this.binaryChecks = 0;
                this.totalObjects = 100000;
                this.targetPosition = 87432;
                this.isRacing = false;
            }

            startRace() {
                if (this.isRacing) return;
                this.reset();
                this.isRacing = true;
                this.race();
            }

            race() {
                const linearInterval = setInterval(() => {
                    if (!this.isRacing) {
                        clearInterval(linearInterval);
                        return;
                    }

                    this.linearChecks += 2000; // Simulate checking 2000 per tick
                    document.getElementById('linear-checks').textContent = this.linearChecks.toLocaleString();
                    
                    if (this.linearChecks >= this.targetPosition) {
                        this.linearChecks = this.targetPosition;
                        clearInterval(linearInterval);
                        this.showRaceResult();
                    }
                    
                    this.render();
                }, 100);

                const binaryInterval = setInterval(() => {
                    if (!this.isRacing) {
                        clearInterval(binaryInterval);
                        return;
                    }

                    this.binaryChecks++;
                    document.getElementById('binary-checks').textContent = this.binaryChecks;
                    
                    // Binary search takes log2(100000) = ~17 steps
                    if (this.binaryChecks >= 17) {
                        clearInterval(binaryInterval);
                    }
                    
                    this.render();
                }, 400);
            }

            showRaceResult() {
                this.isRacing = false;
                const speedup = Math.floor(this.linearChecks / this.binaryChecks);
                document.getElementById('speedup-factor').textContent = `${speedup.toLocaleString()}x`;

                const resultDiv = document.getElementById('race-result');
                resultDiv.style.display = 'block';
                resultDiv.style.background = 'rgba(79, 172, 254, 0.2)';
                resultDiv.style.border = '2px solid #4facfe';
                resultDiv.innerHTML = `
                    <strong style="color: #4facfe;">üèÅ BINARY SEARCH WINS!</strong><br>
                    Linear search: ${this.linearChecks.toLocaleString()} checks<br>
                    Binary search: ${this.binaryChecks} checks<br>
                    <strong>Speedup: ${speedup.toLocaleString()}x faster</strong><br><br>
                    This is why Git builds .idx files for packfiles. O(log n) > O(n) at scale.
                `;
            }

            reset() {
                this.linearChecks = 0;
                this.binaryChecks = 0;
                this.isRacing = false;
                document.getElementById('linear-checks').textContent = '0';
                document.getElementById('binary-checks').textContent = '0';
                document.getElementById('speedup-factor').textContent = '0x';
                document.getElementById('race-result').style.display = 'none';
                this.render();
            }

            render() {
                const linearProgress = Math.min(100, (this.linearChecks / this.targetPosition) * 100);
                const binaryProgress = Math.min(100, (this.binaryChecks / 17) * 100);

                this.canvas.innerHTML = `
                    <div style="display: flex; flex-direction: column; justify-content: center; height: 100%; padding: 40px;">
                        <div style="margin-bottom: 50px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <span style="color: #f5576c; font-weight: bold;">üî¥ Linear Search (O(n))</span>
                                <span style="color: #f5576c;">${this.linearChecks.toLocaleString()} checks</span>
                            </div>
                            <div style="width: 100%; height: 40px; background: rgba(255,255,255,0.1); border-radius: 20px; overflow: hidden;">
                                <div style="width: ${linearProgress}%; height: 100%; background: linear-gradient(90deg, #f5576c 0%, #f093fb 100%); transition: width 0.3s linear; display: flex; align-items: center; justify-content: flex-end; padding-right: 15px;">
                                    ${linearProgress > 10 ? 'üèÉ' : ''}
                                </div>
                            </div>
                        </div>
                        
                            <div class="act-nav">
                                <button id="prev-act">Previous</button>
                                <button id="next-act">Next</button>
                            </div>
                        </div>
                            <div style="width: 100%; height: 40px; background: rgba(255,255,255,0.1); border-radius: 20px; overflow: hidden;">
                                <div style="width: ${binaryProgress}%; height: 100%; background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%); transition: width 0.5s linear; display: flex; align-items: center; justify-content: flex-end; padding-right: 15px;">
                                    ${binaryProgress > 10 ? 'üöÄ' : ''}
                                </div>
                            </div>
                        </div>

                        <div style="text-align: center; margin-top: 40px; opacity: 0.7;">
                            Target: Finding object #${this.targetPosition.toLocaleString()} in ${this.totalObjects.toLocaleString()} objects
                        </div>
                    </div>
                `;
            }
        }

        // Code Typing Animation
        class CodeTypingAnimation {
            constructor(codeElement) {
                this.codeElement = codeElement;
                this.originalHTML = codeElement.innerHTML;
                this.hasAnimated = false;
            }

            animate() {
                if (this.hasAnimated) return;
                this.hasAnimated = true;

                // Clear content
                this.codeElement.innerHTML = '';
                
                // Parse HTML and extract text with tags
                const lines = this.originalHTML.split('\n');
                let currentIndex = 0;

                const typeLine = () => {
                    if (currentIndex >= lines.length) {
                        return;
                    }

                    const line = lines[currentIndex];
                    const lineDiv = document.createElement('div');
                    lineDiv.className = 'code-line';
                    lineDiv.innerHTML = line;
                    this.codeElement.appendChild(lineDiv);

                    currentIndex++;
                    
                    // Vary speed for effect (30-80ms per line)
                    const delay = 30 + Math.random() * 50;
                    setTimeout(typeLine, delay);
                };

                typeLine();
            }
        }

        // Setup Intersection Observer for code blocks
        const setupCodeAnimations = () => {
            const codeBlocks = document.querySelectorAll('.code-display');
            const codeAnimations = [];

            codeBlocks.forEach(block => {
                const animation = new CodeTypingAnimation(block);
                codeAnimations.push({ element: block, animation });
            });

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const animation = codeAnimations.find(a => a.element === entry.target);
                        if (animation) {
                            animation.animation.animate();
                        }
                    }
                });
            }, { threshold: 0.3 });

            codeAnimations.forEach(({ element }) => {
                observer.observe(element);
            });
        };

        // Initialize all animations
        const animation1 = new LinkedListAnimation('canvas1');
        const animation2 = new MemoryAnimation('canvas2');
        const animation2b = new ContentAddressableAnimation('canvas2b');
        const animation3 = new CycleDetectionAnimation('canvas3');
        const animation3b = new MemoryLeakAnimation('canvas3b');
        const animation4 = new EngineeringLayersAnimation('canvas4');
        const animation4b = new BinarySearchAnimation('canvas4b');

        // Initial render
        animation2.render();
        animation2b.render();
        animation3b.render();

        // Add some initial commits for demo
        setTimeout(() => {
            animation1.addCommit();
        }, 800);
        setTimeout(() => {
            animation1.addCommit();
        }, 1800);
        setTimeout(() => {
            animation1.addCommit();
        }, 2800);

        // Setup code typing animations when page loads
    </script>
    <div class="act-nav">
        <button id="prev-act">Previous</button>
        <button id="next-act">Next</button>
    </div>
    <script>
    // --- Act Navigation Logic ---
    window.addEventListener('DOMContentLoaded', () => {
        const actIds = [
            'act-prologue',
            'act-1',
            'act-2',
            'act-2-5',
            'act-3',
            'act-3-5',
            'act-4',
            'act-4-5',
            'act-5',
            'act-epilogue'
        ];
        let currentAct = 0;
        function showAct(idx) {
            actIds.forEach((id, i) => {
                const el = document.getElementById(id);
                if (el) {
                    if (i === idx) {
                        el.classList.add('active');
                        setTimeout(() => el.scrollIntoView({behavior:'smooth'}), 10);
                    } else {
                        el.classList.remove('active');
                    }
                }
            });
            document.getElementById('prev-act').disabled = idx === 0;
            document.getElementById('next-act').disabled = idx === actIds.length-1;
        }
        document.getElementById('prev-act').onclick = () => {
            if (currentAct > 0) {
                currentAct--;
                showAct(currentAct);
            }
        };
        document.getElementById('next-act').onclick = () => {
            if (currentAct < actIds.length-1) {
                currentAct++;
                showAct(currentAct);
            }
        };
        showAct(currentAct);
    });
    </script>
</body>
</html>
